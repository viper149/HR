@model FPrFinishingMachineCreatePreparationViewModel
@{
    ViewData["Title"] = "Finishing Machine Preparation";
    Layout = Layout;
}

    <h2><i class="fa fa-plus-circle fa-lg text-success" aria-hidden="true"></i> Finishing Machine Preparation</h2>
<hr />

<div class="container-fluid">
    @*<div class="stepwizard">
        <div class="stepwizard-row setup-panel d-flex justify-content-around">
            <div class="stepwizard-step">
                <a href="#step-1" type="button" class="btn btn-success btn-circle">1</a>
                <p><small>Step 1</small></p>
            </div>
            <div class="stepwizard-step">
                <a href="#step-2" type="button" class="btn btn-default btn-circle" disabled="disabled">2</a>
                <p><small>Finish</small></p>
            </div>
        </div>
    </div>*@
    <form id="form" role="form" asp-action="CreateFinishingMachinePreparation">
        <div class="panel panel-default">
            <div class="panel-body row">
                <div class="col-lg-2 col-md-3 col-sm-4 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrFinishingMachinePreparation.TRNSDATE" class="control-label"></label>
                        <input asp-for="FPrFinishingMachinePreparation.TRNSDATE" class="form-control" />
                        <span asp-validation-for="FPrFinishingMachinePreparation.TRNSDATE" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrFinishingMachinePreparation.FABCODE" class="control-label"></label>
                        @Html.DropDownListFor(dt => dt.FPrFinishingMachinePreparation.FABCODE, new SelectList(Model.RndFabricInfos, "FABCODE", "STYLE_NAME"), "", htmlAttributes: new { @class = "form-control js-example-basic-single" })
                        <span asp-validation-for="FPrFinishingMachinePreparation.FABCODE" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrFinishingMachinePreparation.MACHINE_NO" class="control-label"></label>
                        @Html.DropDownListFor(dt => dt.FPrFinishingMachinePreparation.MACHINE_NO, new SelectList(Model.FPrFnMachineInfos, "FN_MACHINEID", "NAME"), "", htmlAttributes: new { @class = "form-control js-example-basic-single" })
                        <span asp-validation-for="FPrFinishingMachinePreparation.MACHINE_NO" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrFinishingMachinePreparation.FIN_PRO_TYPEID" class="control-label"></label>
                        @Html.DropDownListFor(dt => dt.FPrFinishingMachinePreparation.FIN_PRO_TYPEID, new SelectList(Model.FPrFnProcessTypeInfos, "FIN_PRO_TYPEID", "NAME"), "", htmlAttributes: new { @class = "form-control js-example-basic-single" })
                        <span asp-validation-for="FPrFinishingMachinePreparation.FIN_PRO_TYPEID" class="text-danger"></span>
                    </div>
                </div>

                <div class="col-lg-2 col-md-3 col-sm-4 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrFinishingMachinePreparation.FINISH_ROUTE" class="control-label"></label>
                        <input asp-for="FPrFinishingMachinePreparation.FINISH_ROUTE" class="form-control" readonly="readonly" />
                        <span asp-validation-for="FPrFinishingMachinePreparation.FINISH_ROUTE" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4 col-xs-12">
                    <div class="form-group">
                        <label class="control-label">Total Ends</label>
                        <span class="custom-form-control-bg form-control bg-e9ecef" id="totalEnds">
                        </span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4 col-xs-12">
                    <div class="form-group">
                        <label class="control-label">Color</label>
                        <span class="custom-form-control-bg form-control bg-e9ecef" id="color">
                        </span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4 col-xs-12">
                    <div class="form-group">
                        <label class="control-label">Loom Type</label>
                        <span class="custom-form-control-bg form-control bg-e9ecef" id="loomType">
                        </span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrFinishingMachinePreparation.REMARKS" class="control-label"></label>
                        <input asp-for="FPrFinishingMachinePreparation.REMARKS" class="form-control" />
                        <span asp-validation-for="FPrFinishingMachinePreparation.REMARKS" class="text-danger"></span>
                    </div>
                </div>

                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 row">

                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <h2 class="panel-title text-success">Doff. List</h2>
                        <hr />
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                        <div class="form-group">
                            @Html.HiddenFor(c=> c.FPrFinighingDoffForMachine.OPT3)
                            <label asp-for="FPrFinighingDoffForMachine.FN_PROCESSID" class="control-label"></label>
                            <select asp-for="FPrFinighingDoffForMachine.FN_PROCESSID" class="form-control js-example-basic-single">
                                <option value=""></option>
                            </select>
                            <span asp-validation-for="FPrFinighingDoffForMachine.FN_PROCESSID" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="col-lg-2 col-md-3 col-sm-4 col-xs-12">
                        <div class="form-group">
                            <label class="control-label">Output Length</label>
                            <span class="custom-form-control-bg form-control bg-e9ecef" id="outputLength">
                            </span>
                        </div>
                    </div>

                    <div class="col-lg-2 col-md-3 col-sm-4 col-xs-12">
                        <div class="form-group">
                            <label asp-for="FPrFinighingDoffForMachine.REMARKS" class="control-label"></label>
                            <input asp-for="FPrFinighingDoffForMachine.REMARKS" class="form-control" />
                            <span asp-validation-for="FPrFinighingDoffForMachine.REMARKS" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        @*<button class="btn btn-info nextBtn pull-right" type="button">Next</button>*@
                        <button id="btnAddDoff" class="btn btn-success pull-right mr-2" type="button" accesskey="x">Add</button>
                        @*<a asp-action="GetFinishingMachinePreparationList" class="btn btn-dark pull-right mr-2">Back to List</a>*@
                    </div>

                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 table-responsive" id="doffDetails">
                        @await Html.PartialAsync($"~/Views/FPrFinishingMachinePreperation/AddDoffList.cshtml", Model)
                    </div>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 row">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <h2 class="panel-title text-success">Chemical Consumption</h2>
                        <hr />
                    </div>
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 d-none">
                        <div class="form-group">
                            <label asp-for="FPrFnChemicalConsumption.TRNSDATE" class="control-label"></label>
                            <input asp-for="FPrFnChemicalConsumption.TRNSDATE" class="form-control" />
                            <span asp-validation-for="FPrFnChemicalConsumption.TRNSDATE" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-3 col-sm-4 col-xs-12">
                        <div class="form-group">
                            <label asp-for="FPrFnChemicalConsumption.CHEM_PROD_ID" class="control-label"></label>
                            @Html.DropDownListFor(dt => dt.FPrFnChemicalConsumption.CHEM_PROD_ID, new SelectList(Model.FChemStoreProductInfos, "PRODUCTID", "PRODUCTNAME"), "", htmlAttributes: new { @class = "form-control js-example-basic-single" })
                            <span asp-validation-for="FPrFnChemicalConsumption.CHEM_PROD_ID" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-3 col-sm-4 col-xs-12 d-none">
                        <div class="form-group">
                            <label asp-for="FPrFnChemicalConsumption.STOCK_QTY" class="control-label"></label>
                            <input asp-for="FPrFnChemicalConsumption.STOCK_QTY" class="form-control" />
                            <span asp-validation-for="FPrFnChemicalConsumption.STOCK_QTY" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-3 col-sm-4 col-xs-12 d-none">
                        <div class="form-group">
                            <label asp-for="FPrFnChemicalConsumption.RECIPE" class="control-label"></label>
                            <input asp-for="FPrFnChemicalConsumption.RECIPE" class="form-control" />
                            <span asp-validation-for="FPrFnChemicalConsumption.RECIPE" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-3 col-sm-4 col-xs-12 d-none">
                        <div class="form-group">
                            <label asp-for="FPrFnChemicalConsumption.SUG_QTY" class="control-label"></label>
                            <input asp-for="FPrFnChemicalConsumption.SUG_QTY" class="form-control" />
                            <span asp-validation-for="FPrFnChemicalConsumption.SUG_QTY" class="text-danger"></span>
                        </div>
                    </div> 
                    <div class="col-lg-2 col-md-3 col-sm-4 col-xs-12">
                        <div class="form-group">
                            <label asp-for="FPrFnChemicalConsumption.QTY" class="control-label"></label>
                            <input asp-for="FPrFnChemicalConsumption.QTY" class="form-control" />
                            <span asp-validation-for="FPrFnChemicalConsumption.QTY" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-3 col-sm-4 col-xs-12">
                        <div class="form-group">
                            <label asp-for="FPrFnChemicalConsumption.REMARKS" class="control-label"></label>
                            <input asp-for="FPrFnChemicalConsumption.REMARKS" class="form-control" />
                            <span asp-validation-for="FPrFnChemicalConsumption.REMARKS" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <button class="btn btn-success pull-right" type="submit" id="btn_submit">Create</button>
                        <button id="btnAddChem" class="btn btn-success pull-right mr-2" type="button" accesskey="c">Add</button>
                        <button class="btn btn-info prevBtn pull-right" type="button">Prev</button>
                        <a asp-action="GetFinishingMachinePreparationList" class="btn btn-dark pull-right mr-2">Back to List</a>
                    </div>

                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 table-responsive" id="chemDetails">
                        @await Html.PartialAsync($"~/Views/FPrFinishingMachinePreperation/AddChemList.cshtml", Model)
                    </div>
                </div>


            </div>
        </div>

        @*<div class="panel panel-primary setup-content" id="step-2">
            <div class="panel-body row">
                
            </div>
        </div>*@
    </form>
</div>

@section Styles {
    <link href="~/css/CustomCSS/Stepper.css" rel="stylesheet" asp-append-version="true" />
}

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptPartial_Except_jQuery");}
    <script src="~/js/custom-js/Stepper.js" asp-append-version="true"></script>
    <script type="text/javascript" asp-append-version="true">

        $(function() {
            $("#btnAddChem").on('click',
                function() {
                    $.ajax({
                        async: true,
                        cache: false,
                        data: $('#form').serialize(),
                        type: "POST",
                        url: "/FPrFinishingMachinePreperation/AddChemList",
                        success: function(partialView, status, xhr) {
                            $('#chemDetails').html(partialView);
                        },
                        error: function(e) {
                            console.log(e);
                        }
                    });
                });


            $("#btnAddDoff").on('click',
                function() {
                    $.ajax({
                        async: true,
                        cache: false,
                        data: $('#form').serialize(),
                        type: "POST",
                        url: "/FPrFinishingMachinePreperation/AddDoffList",
                        success: function(partialView, status, xhr) {
                            $('#doffDetails').html(partialView);
                        },
                        error: function(e) {
                            console.log(e);
                        }
                    });
                });


            $("#FPrFinishingMachinePreparation_FABCODE").on('change',
                function() {
                    var selectedVal = $(this).val();
                    $.ajax({
                        async: true,
                        cache: false,
                        data: { "fabcode": selectedVal},
                        type: "GET",
                        url: "/FPrFinishingMachinePreperation/GetStyleDetails",
                        success: function(data, status, xhr) {
                            //console.log(data);
                            if (data.length !== 0) {
                                $("#color").text(data[0].color);
                                $("#totalEnds").text(data[0].totalEnds);
                                $("#FPrFinishingMachinePreparation_FINISH_ROUTE").val(data[0].finishRoute);
                                $("#loomType").text(data[0].loomType);

                                $("#FPrFinighingDoffForMachine_FN_PROCESSID").html('');
                                $("#FPrFinighingDoffForMachine_FN_PROCESSID").append('<option value="" selected></option>');
                                $.each(data,
                                    function(id, option) {
                                        $("#FPrFinighingDoffForMachine_FN_PROCESSID").append($('<option></option>').val(option.doffList.fN_PROCESSID).html(option.doffList.doff));
                                    });
                            } else {
                                toastr.error("No Doff Found!", "Not Found");
                                $("#btn_submit").prop('disabled', true);
                            }
                        },
                        error: function(e) {
                            console.log(e);
                        }
                    });
                });


            $("#FPrFinighingDoffForMachine_FN_PROCESSID").on('change',
                function() {
                    var selectedVal = $(this).val();
                    var processType = $("#FPrFinishingMachinePreparation_FIN_PRO_TYPEID").val();
                    var date = $("#FPrFinishingMachinePreparation_TRNSDATE").val();

                    if (processType === "") {
                        toastrNotification("Please Select Process Type","error");
                        $("#FPrFinighingDoffForMachine_FN_PROCESSID").val("");
                        return false;
                    }
                    $.ajax({
                        async: true,
                        cache: false,
                        data: $('#form').serialize(),
                        type: "GET",
                        url: "/FPrFinishingMachinePreperation/GetDoffDetails",
                        success: function (data, status, xhr) {
                            if (data !== null) {
                                if ($("#FPrFinishingMachinePreparation_FIN_PRO_TYPEID").val() === "17") {
                                    $("#outputLength").text(data.lengthOut);
                                } else {
                                    $("#outputLength").text(data.lengthOut);
                                }
                                $("#FPrFinighingDoffForMachine_OPT3").val(data.fiN_PROCESSID);
                            } else {
                                $("#outputLength").text("");
                                toastr.error("No Length Found!", "Not Found");
                                $("#btn_submit").prop('disabled', true);
                            }
                        },
                        error: function(e) {
                            console.log(e);
                        }
                    });
                });
        });
    </script>
}

@model FSizingProductionRopeViewModel

@{
    ViewData["Title"] = "Edit Sizing Process (Rope)";
    Layout = Layout;
}

<h2><i class="fa fa-edit fa-lg text-warning" aria-hidden="true"></i> Edit Sizing Process (Rope)</h2>

<div class="container-fluid">
    <div class="stepwizard">
        <div class="stepwizard-row setup-panel d-flex justify-content-around">
            <div class="stepwizard-step">
                <a href="#step-1" type="button" class="btn btn-success btn-circle">1</a>
                <p><small>Step 1</small></p>
            </div>
            <div class="stepwizard-step">
                <a href="#step-2" type="button" class="btn btn-default btn-circle" disabled="disabled">2</a>
                <p><small>Finish</small></p>
            </div>
        </div>
    </div>

    <form id="form" role="form" asp-action="EditSizingProductionRope">
        <div class="panel panel-default setup-content" id="step-1">
            <div class="panel-body row">
                @Html.HiddenFor(c => c.FPrSizingProcessRopeMaster.EncryptedId)
                @Html.HiddenFor(c => c.FPrSizingProcessRopeMaster.SID)
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeMaster.TRNSDATE" class="control-label"></label>
                        <input asp-for="FPrSizingProcessRopeMaster.TRNSDATE" class="form-control" />
                        <span asp-validation-for="FPrSizingProcessRopeMaster.TRNSDATE" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeMaster.SETID" class="control-label"></label>
                        @Html.HiddenFor(c => c.FPrSizingProcessRopeMaster.SETID)
                        <span class="custom-form-control-bg form-control bg-e9ecef">
                            @Html.DisplayFor(c => c.FPrSizingProcessRopeMaster.SET.PROG_.PROG_NO)
                        </span>
                        <span asp-validation-for="FPrSizingProcessRopeMaster.SETID" class="text-danger"></span>
                    </div>
                </div>

                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label class="control-label">LCB Length</label>
                        <span class="custom-form-control-bg form-control bg-e9ecef" id="setLength">
                        </span>
                    </div>
                </div>
                @Html.HiddenFor(c => c.FPrSizingProcessRopeMaster.LCB_LENGTH)
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeMaster.LCB_ACT_LENGTH" class="control-label"></label>
                        <input asp-for="FPrSizingProcessRopeMaster.LCB_ACT_LENGTH" class="form-control" />
                        <span asp-validation-for="FPrSizingProcessRopeMaster.LCB_ACT_LENGTH" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeMaster.BEAM_SPACE" class="control-label"></label>
                        <input asp-for="FPrSizingProcessRopeMaster.BEAM_SPACE" class="form-control" />
                        <span asp-validation-for="FPrSizingProcessRopeMaster.BEAM_SPACE" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeMaster.PICK_UP" class="control-label"></label>
                        <input asp-for="FPrSizingProcessRopeMaster.PICK_UP" class="form-control" />
                        <span asp-validation-for="FPrSizingProcessRopeMaster.PICK_UP" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeMaster.SIZING_ENDS" class="control-label"></label>
                        <input asp-for="FPrSizingProcessRopeMaster.SIZING_ENDS" class="form-control" readonly="readonly" />
                        <span asp-validation-for="FPrSizingProcessRopeMaster.SIZING_ENDS" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeMaster.TOTAL_ENDS" class="control-label"></label>
                        <input asp-for="FPrSizingProcessRopeMaster.TOTAL_ENDS" class="form-control" readonly="readonly" />
                        <span asp-validation-for="FPrSizingProcessRopeMaster.TOTAL_ENDS" class="text-danger"></span>
                    </div>
                </div>

                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label class="control-label">Style Name</label>
                        <span class="custom-form-control-bg form-control bg-e9ecef" id="style">
                        </span>
                    </div>
                </div>

                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label class="control-label">Buyer</label>
                        <span class="custom-form-control-bg form-control bg-e9ecef" id="buyer">
                        </span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label class="control-label">Color</label>
                        <span class="custom-form-control-bg form-control bg-e9ecef" id="color">
                        </span>
                    </div>
                </div>

                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label class="control-label">Loom Type</label>
                        <span class="custom-form-control-bg form-control bg-e9ecef" id="loomType">
                        </span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label class="control-label">Order No</label>
                        <span class="custom-form-control-bg form-control bg-e9ecef" id="orderNo">
                        </span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label class="control-label">Ratio</label>
                        <span class="custom-form-control-bg form-control bg-e9ecef" id="ratio">
                        </span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label class="control-label">PO No</label>
                        <span class="custom-form-control-bg form-control bg-e9ecef" id="poNo">
                        </span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeMaster.REMARKS" class="control-label"></label>
                        <input asp-for="FPrSizingProcessRopeMaster.REMARKS" class="form-control" />
                        <span asp-validation-for="FPrSizingProcessRopeMaster.REMARKS" class="text-danger"></span>
                    </div>
                </div>


                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 d-flex justify-content-end">
                    <div class="form-group mb-0 pr-2 border-dark border-right">
                        <strong><label class="control-label mb-0">Production</label></strong>
                        <span class="custom-form-control form-control bg-e9ecef">
                            <strong id="production"><span id="prod">00.00</span></strong><strong> M</strong>
                        </span>
                    </div>
                    <div class="form-group mb-0 pl-2">
                        <strong><label class="control-label mb-0">Pending</label></strong>
                        <span class="custom-form-control form-control bg-e9ecef">
                            <strong id="pending"><span id="pend">00.00</span></strong><strong> M</strong>
                        </span>
                    </div>
                </div>
                
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <button id="btnAddBeam" class="btn btn-success pull-right mr-2" type="button">Add</button>
                <button class="btn btn-info nextBtn pull-right" type="button">Next</button>
                <a asp-action="GetSizingProductionRope" class="btn btn-dark pull-right mr-2">Back to List</a>
            </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <h2 class="panel-title text-success">Weaving Beam Consumption</h2>
                    <hr />
                </div>

                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeDetails.S_MID" class="control-label"></label>
                        @Html.DropDownListFor(dt => dt.FPrSizingProcessRopeDetails.S_MID, new SelectList(Model.FSizingMachines, "ID", "MACHINE_NO"), "Select Machine No.", htmlAttributes: new { @class = "form-control js-example-basic-single" })
                        <span asp-validation-for="FPrSizingProcessRopeDetails.S_MID" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeDetails.W_BEAMID" class="control-label"></label>
                        @Html.DropDownListFor(dt => dt.FPrSizingProcessRopeDetails.W_BEAMID, new SelectList(Model.FWeavingBeams, "ID", "BEAM_NO"), "Select Beam No.", htmlAttributes: new { @class = "form-control js-example-basic-single" })
                        <span asp-validation-for="FPrSizingProcessRopeDetails.W_BEAMID" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeDetails.BEAM_TYPE" class="control-label"></label>
                        <select asp-for="FPrSizingProcessRopeDetails.BEAM_TYPE" class="form-control js-example-basic-single">
                            <option value="">Select Process No</option>
                            <option value="Airjet">Airjet</option>
                            <option value="Rapier">Rapier</option>
                        </select>
                        <span asp-validation-for="FPrSizingProcessRopeDetails.BEAM_TYPE" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeDetails.LENGTH_PER_BEAM" class="control-label"></label>
                        <input asp-for="FPrSizingProcessRopeDetails.LENGTH_PER_BEAM" class="form-control" />
                        <span asp-validation-for="FPrSizingProcessRopeDetails.LENGTH_PER_BEAM" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeDetails.BREAK_PER_BEAM" class="control-label"></label>
                        <input asp-for="FPrSizingProcessRopeDetails.BREAK_PER_BEAM" class="form-control" />
                        <span asp-validation-for="FPrSizingProcessRopeDetails.BREAK_PER_BEAM" class="text-danger"></span>
                    </div>
                </div>
                @*<div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeDetails.BREAK_PER_BEAM_B" class="control-label"></label>
                        <input asp-for="FPrSizingProcessRopeDetails.BREAK_PER_BEAM_B" class="form-control" />
                        <span asp-validation-for="FPrSizingProcessRopeDetails.BREAK_PER_BEAM_B" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeDetails.BREAK_PER_BEAM_C" class="control-label"></label>
                        <input asp-for="FPrSizingProcessRopeDetails.BREAK_PER_BEAM_C" class="form-control" />
                        <span asp-validation-for="FPrSizingProcessRopeDetails.BREAK_PER_BEAM_C" class="text-danger"></span>
                    </div>
                </div>*@
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeDetails.EMPID" class="control-label"></label>
                        @Html.DropDownListFor(dt => dt.FPrSizingProcessRopeDetails.EMPID, new SelectList(Model.FHrEmployees, "EMPID", "FIRST_NAME"), "Select Employee", htmlAttributes: new { @class = "form-control js-example-basic-single" })
                        <span asp-validation-for="FPrSizingProcessRopeDetails.EMPID" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeDetails.SHIFT" class="control-label"></label>
                        <select asp-for="FPrSizingProcessRopeDetails.SHIFT" class="form-control js-example-basic-single">
                            <option value="">Select Process No</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                        </select>
                        <span asp-validation-for="FPrSizingProcessRopeDetails.SHIFT" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeDetails.REMARKS" class="control-label"></label>
                        <input asp-for="FPrSizingProcessRopeDetails.REMARKS" class="form-control" />
                        <span asp-validation-for="FPrSizingProcessRopeDetails.REMARKS" class="text-danger"></span>
                    </div>
                </div>

                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeDetails.IS_DELIVERABLE" class="control-label"></label>
                        <div class="form-control custom-form-control">
                            <label class="switch">
                                <input asp-for="FPrSizingProcessRopeDetails.IS_DELIVERABLE" />
                                <span class="slider round"></span>
                                <span class="absolute-no">NO</span>
                            </label>
                        </div>
                        <span asp-validation-for="FPrSizingProcessRopeDetails.IS_DELIVERABLE" class="text-danger"></span>
                    </div>
                </div>

                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 table-responsive" id="beamDetails">
                    @await Html.PartialAsync($"~/Views/FPrSizingProductionRope/AddBeamList.cshtml", Model)
                </div>




            </div>
        </div>

        <div class="panel panel-primary setup-content" id="step-2">
            <div class="panel-body row">

                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <h2 class="panel-title text-success">Chemical Consumption</h2>
                    <hr />
                </div>

                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeChem.CHEM_PRODID" class="control-label"></label>
                        @Html.DropDownListFor(dt => dt.FPrSizingProcessRopeChem.CHEM_PRODID, new SelectList(Model.FChemStoreProductInfos, "PRODUCTID", "PRODUCTNAME"), "Select Product", htmlAttributes: new { @class = "form-control js-example-basic-single" })
                        <span asp-validation-for="FPrSizingProcessRopeChem.CHEM_PRODID" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeChem.QTY" class="control-label"></label>
                        <input asp-for="FPrSizingProcessRopeChem.QTY" class="form-control" />
                        <span asp-validation-for="FPrSizingProcessRopeChem.QTY" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeChem.UNIT" class="control-label"></label>
                        <select asp-for="FPrSizingProcessRopeChem.UNIT" class="form-control">
                            <option value="">Select Unit</option>
                            <option value="KG" selected>KG</option>
                            <option value="Liter">Liter</option>
                        </select>
                        <span asp-validation-for="FPrSizingProcessRopeChem.UNIT" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="FPrSizingProcessRopeChem.REMARKS" class="control-label"></label>
                        <input asp-for="FPrSizingProcessRopeChem.REMARKS" class="form-control" />
                        <span asp-validation-for="FPrSizingProcessRopeChem.REMARKS" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <button class="btn btn-warning pull-right" type="submit" id="btn_submit">Update</button>
                    <button id="btnAddChem" class="btn btn-success pull-right mr-2" type="button">Add</button>
                    <button class="btn btn-info prevBtn pull-right" type="button">Prev</button>
                    <a asp-action="GetSizingProductionRope" class="btn btn-dark pull-right">Back to List</a>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 table-responsive" id="ChemDetails">
                    @await Html.PartialAsync($"~/Views/FPrSizingProductionRope/AddChemList.cshtml", Model)
                </div>
            </div>
        </div>
    </form>
</div>

@section Styles {
    <link href="~/css/CustomCSS/Stepper.css" rel="stylesheet" asp-append-version="true" />
}

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptPartial_Except_jQuery");}
    <script src="~/js/custom-js/Stepper.js" asp-append-version="true"></script>
    <script type="text/javascript" asp-append-version="true">
        $(function () {
            getSetDetails($("#FPrSizingProcessRopeMaster_SETID").val());
            addBeam();

            $("#btnAddChem").on('click',
                function () {
                    $.ajax({
                        async: true,
                        cache: false,
                        data: $('#form').serialize(),
                        type: "POST",
                        url: "/FPrSizingProductionRope/AddChemList",
                        success: function (partialView, status, xhr) {
                            //console.log(partialView);
                            $('#ChemDetails').html(partialView);
                        },
                        error: function (e) {
                            console.log(e);
                        }
                    });
                });

            $("#btnAddBeam").on('click',
                function () {
                    addBeam();
                });


            $("#FPrSizingProcessRopeMaster_SETID").on('change',
                function () {
                    var selectedVal = $(this).val();
                    getSetDetails(selectedVal);
                });
        });


        
        function addBeam() {
            console.log("abc");
            $.ajax({
                async: true,
                cache: false,
                data: $('#form').serialize(),
                type: "POST",
                url: "/FPrSizingProductionRope/AddBeamList",
                success: function (partialView, status, xhr) {
                    //console.log(partialView);
                    setQty(xhr);
                    $('#beamDetails').html(partialView);
                },
                error: function (e) {
                    console.log(e);
                }
            });
        }

        function getSetDetails(selectedVal) {
            $.ajax({
                async: true,
                cache: false,
                data: { "setId": selectedVal },
                type: "GET",
                url: "/FPrSizingProductionRope/GetSetDetails",
                success: function (data, status, xhr) {
                    console.log("Edit");
                    $("#style").text(data.comExPiDetails.style.fabcodeNavigation.stylE_NAME);
                    $("#buyer").text(data.comExPiDetails.pimaster.buyer.buyeR_NAME);
                    $("#color").text(data.comExPiDetails.style.fabcodeNavigation.colorcodeNavigation.color);
                    $("#loomType").text(data.comExPiDetails.style.fabcodeNavigation.loom.looM_TYPE_NAME);
                    $("#orderNo").text(data.comExPiDetails.sO_NO);
                    $("#ratio").text(data.plProductionSetDistribution.subgroup.ratio);
                    //$("#FPrSizingProcessRopeMaster_TOTAL_ENDS").val(data.plProductionSetDistribution.proG_.blK_PROG_.rndProductionOrder.totaL_ENOS);
                    //$("#FPrSizingProcessRopeMaster_SIZING_ENDS").val(data.plProductionSetDistribution.proG_.blK_PROG_.rndProductionOrder.totaL_ENOS);
                    $("#poNo").text(data.comExPiDetails.pimaster.pino);
                    //$("#setLength").text(data.plProductionSetDistribution.f_LCB_PRODUCTION_ROPE_MASTER[0].lcB_LENGTH);
                    //$("#FPrSizingProcessRopeMaster_LCB_ACT_LENGTH").val(data.plProductionSetDistribution.f_LCB_PRODUCTION_ROPE_MASTER[0].lcB_LENGTH);
                    //$("#FPrSizingProcessRopeMaster_LCB_LENGTH").val(data.plProductionSetDistribution.f_LCB_PRODUCTION_ROPE_MASTER[0].lcB_LENGTH);
                    //$("#pend").text(data.plProductionSetDistribution.f_PR_WARPING_PROCESS_ROPE_DETAILS[0].warP_LENGTH_PER_SET);

                    var setLength = data.plProductionSetDistribution.f_PR_WARPING_PROCESS_ROPE_DETAILS[0].warP_LENGTH_PER_SET;
                    var subGroupLength = data.plProductionSetDistribution.subgroup.f_PR_WARPING_PROCESS_ROPE_MASTER[0].warP_LENGTH;
                    var LCBLength = data.plProductionSetDistribution.subgroup.f_LCB_PRODUCTION_ROPE_MASTER[0].lcB_LENGTH;


                    var setRatioLength = ((setLength * LCBLength) / subGroupLength).toFixed(0);


                    $("#setLength").text(setRatioLength);

                },
                error: function (e) {
                    console.log(e);
                }
            });
        }

        function setQty(xhr) {
            var pending = xhr.getResponseHeader("Pending");
            var production = xhr.getResponseHeader("Production");
            $('#pend').text(pending);
            $('#prod').text(production);
            if ($('#pend').text() < -1500) {
                $('#pending').addClass('text-danger');
                $('#btn_submit').prop('disabled', true);
                $('#btnAddBeam').prop('disabled', true);
            } else {
                $('#pending').removeClass('text-danger');
                $('#btn_submit').prop('disabled', false);
                $('#btnAddBeam').prop('disabled', false);
            }
        }

    </script>
}
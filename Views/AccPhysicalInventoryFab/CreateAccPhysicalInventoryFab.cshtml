
@model AccPhysicalInventoryFabViewModel


@{
    ViewData["Title"] = "Physical Inventory (Fabric)";
    Layout = Layout;
}

@*<style>
    .rowqr{
        display:flex;
    }
</style>*@

<h2><i class="fa fa-plus-circle fa-lg text-success" aria-hidden="true"></i> @ViewData["Title"]</h2>
<hr />

<div class="container-fluid">
    <form id="form" role="form" asp-action="CreateAccPhysicalInventoryFab">
        <div class="panel panel-default">
            <div class="panel-body row">
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                    <div class="form-group">
                        <label asp-for="AccPhysicalInventoryFab.ROLL_NO" class="control-label"></label>
                        <input asp-for="AccPhysicalInventoryFab.ROLL_NO" class="form-control" />
                        <span asp-validation-for="AccPhysicalInventoryFab.ROLL_NO" class="text-danger"></span>
                    </div>
                    @*<div id="result">Result Here</div>*@

                </div>
                <div class="col-lg-2 col-md-3 col-sm-3 col-xs-12">
                    <div class="form-group">
                        <label asp-for="AccPhysicalInventoryFab.IS_MANUAL" class="control-label"></label>
                        <div class="form-control custom-form-control">
                            <label class="switch">
                                <input asp-for="AccPhysicalInventoryFab.IS_MANUAL" />
                                <span class="slider round"></span>
                                <span class="absolute-no">NO</span>
                            </label>
                        </div>
                    </div>
                </div>
                @*Open Camera*@
                <!--<div class="col-lg-2 col-md-3 col-sm-3 col-xs-12">
                    <div class=".rowqr">
                        <div class="col">
                            <div style="width:500px;" id="reader"></div>
                        </div>-->
                        @*<div class="col" style="padding:30px;">
                            <h4>SCAN RESULT</h4>
                        </div>*@
                    <!--</div>
                </div>-->

                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 d-none">
                    <button class="btn btn-success pull-right" type="submit" id="btn_submit">Create</button>
                </div>

                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" id="rollDetails">
                    @await Html.PartialAsync($"~/Views/AccPhysicalInventoryFab/GetAccPhysicalInventoryFab.cshtml", Model)
                </div>
            </div>
        </div>
    </form>
</div>

@section Styles
{
    <link asp-append-version="true" href="~/lib/datatables/css/dataTables.bootstrap4.min.css" rel="stylesheet" />
}

@section Scripts {
    @{await Html.RenderPartialAsync($"_ValidationScriptPartial_Except_jQuery");}

    <script asp-append-version="true" src="~/lib/datatables/js/jquery.dataTables.min.js"></script>
    <script asp-append-version="true" src="~/lib/datatables/js/dataTables.bootstrap4.min.js"></script>
    <script asp-append-version="true" src="~/js/AccPhysicalInventoryFab/GetAccPhysicalInventoryFab.js"></script>
    <script asp-append-version="true" src="~/js/AccPhysicalInventoryFab/CreateAccPhysicalInventoryFab.js"></script>
    @*<script asp-append-version="true" src="~/js/qrcodescan/html5-qrcode.min.js"></script>*@

    @*<script asp-append-version="true" type="text/javascript">
        function onScanSuccess(qrCodeMessage) {
            document.getElementById('AccPhysicalInventoryFab_ROLL_NO').value = qrCodeMessage;
            call();
        }
        function onScanError(errorMessage) {
            //handle scan error
        }
        var html5QrcodeScanner = new Html5QrcodeScanner(
            "reader", { fps: 10, qrbox: 250 });
        html5QrcodeScanner.render(onScanSuccess, onScanError);


        var rollNo = $("#AccPhysicalInventoryFab_ROLL_NO");

        $(document).ready(function () {
            rollNo.val("");
            rollNo.focus();
        });


        let timer;
        rollNo.on('input',
            code => {
                call();
            });

        function call() {
            clearTimeout(timer);
            console.log('TIMER');
            console.log(rollNo.val());
            scanRoll(10000);
            //timer = setTimeout(x => {
            //    console.log(rollNo.text());
            //    if (rollNo.val()) {
            //        console.log('if');
            //        var manual = $("#AccPhysicalInventoryFab_IS_MANUAL").prop('checked');
            //        if (manual) {
            //            scanRoll(10000);
            //        } else {
            //            console.log('else');
            //            debugger;
            //            scanRoll(500);
            //        }
            //    }
            //}, 1000, code);
        }


        function scanRoll(time) {
            console.log("caa");
            setTimeout(() => {
                    var viewModel = $("#form").serializeArray();
                    var formData = {
                        "rollNo": rollNo.val()
                    };
                    $.post("/AccPhysicalInventoryFab/IsReceivedOrDuplicate",
                        formData,
                        function (data) {
                            console.log(data);
                            if (data === true) {
                                $.post("/AccPhysicalInventoryFab/CreateAccPhysicalInventoryFab",
                                    viewModel);
                                location.reload(true);
                            } else {
                                toastrNotification(data, "warning");
                                rollNo.val("");
                                rollNo.focus();
                            }
                    
                        });
            
                },
                time);
        }


    </script>*@
}